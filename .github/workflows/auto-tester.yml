name: Auto tester
on: [pull_request]
env:
  RUNNER_BIN: /bin/runner
jobs:
  run-c-challenges:
    runs-on: ubuntu-latest
    container: 
      image: luisferreira32/crunner:latest
      options: --user root # workaround for known permissions issue in checkout action
    steps:
      - name: Checkout
        uses: actions/checkout@v1
        with:
          fetch-depth: 2
      
      - name: Compile and build code
        run: make compile build

      - name: Run changes
        id: run_changes
        run: |
          output=$(git diff --name-only HEAD..origin/main | python3 scripts/prcheck.py)
          echo ::set-output name=error::$output

      # will exit successfully or with error depending on test results
      - name: Check success
        run: exit ${{ steps.run_changes.outputs.error }}